---
layout: default
title: insertion Sort
---

<style>
  .visual-array {
		padding: 1em;
		display: flex;
		flex-direction: row; /* Stack children vertically */
    	justify-content: flex-start; /* Align children to the bottom */
		align-items: flex-end;
    	height: 100%; /* Ensure the container takes the full height */
	}

	.array-element {
		background-color: #a4a4a4;
		width: 0.8em; /* default value */
		height: 12em; /* default value */
		margin: 0em; /* default value */
	}
	.array-element {
		background-color: #a4a4a4;
		width: 1em;
		height: 12em;
	}
</style>
<div class="w-1000 h-1000 bg-gray-100">
  <section class="w-full h-full bg-gray-200" id="canvas">
    <div class="visual-array" id="visual-array"></div>
  </section>
</div>
<div class="mx-auto" id="control">
  <button class="btn" onclick="createElementDivs()">Generate Random Array</button>
  <label for="size" class="btn no-animation">Enter Array Size</label>
  <input type="text" id="size" name="size" class="btn input-ghost"/>
  <button class="btn" onclick="sort()">Sort</button>
  <label id="time-display" class="btn no-animation">Time: N/A</label>
</div>

<div class="bg-gray-500">
  <p class="text-lg">hi</p>
</div>

<script>
	var array = [];
	var length = 0;
	var animations = [];
	let total_width = 0;
	let width = 0;
	let margin = 0;


	async function sort() {
		await getAnimations();
		for (i = 0; i < animations.length-1; i++) {
			console.log(animations[i]);
			let arr = animations[i].arr;
			let num = animations[i].int[0];
      let move = animations[i].int[1];
			setTimeout(function() {
				
				renderFrame(arr, num, move);
			}, i*0.001);
		}
		time = document.getElementById("time-display");
		time.innerHTML = "Time: " + animations[animations.length-1].time + " ns"

	}

	function getAnimations() {
		const payload = {
			length: length,
			array: array
		};

		// Backend URL
		const backendURL = 'http://localhost:8386/api/sorting/insertion';

		// Creating a new XMLHttpRequest object
		const xhr = new XMLHttpRequest();
		xhr.open('POST', backendURL, true);
		xhr.setRequestHeader('Content-Type', 'application/json');

		// Handling the response from the server
		return new Promise((resolve, reject) => {
			xhr.onload = function() {
			
				if(xhr.status >= 200 && xhr.status < 300) {
					const response = JSON.parse(xhr.responseText);
					console.log('Response from server:', response);
					
					resolve(response)
					animations = response;
				} else {
					console.error('Request failed with status:', xhr.status);
				}
				};
			
				// Handling errors during the request
				xhr.onerror = function() {
				console.error('Request failed');
				};
			
				// Sending the request with the JSON payload
				xhr.send(JSON.stringify(payload));
		});
	}

	function renderFrame(arr, num, move) {
    clearDivs();
    total_width = 68 / length;
    width = 0.8 * total_width;
    margin = 0 * total_width;
    for (let i = 0; i < length; i++) {
      let container = document.createElement("container");
      let element = document.createElement("div");
      let label = document.createElement("div");
      element.classList.add("array-element");
      element.style.width = width + "em";
      element.style.margin = margin + "em";
      element.style.height = (arr[i] / 19) + "em";
      label.classList.add("element-label");
      if (i == num) {
          element.style.backgroundColor = "red";
      } else if (i == move) {
          element.style.backgroundColor = "pink";
      }
      container.appendChild(label);
      container.appendChild(element);
      document.getElementById("visual-array").appendChild(container);
  }
  }


	function clearDivs() { 
        let element = document.getElementById("visual-array"); 
        
        let child = element.lastElementChild;  
        while (child) { 
            element.removeChild(child); 
            child = element.lastElementChild; 
        } 
    } 

	function createElementDivs() {
		clearDivs();
		array = []
		length = document.getElementById('size').value;
		const allValues = Array.from({ length: 501 }, (_, i) => i);

    // Shuffle the array to get random order
    const shuffledValues = shuffleArray(allValues);

    // Take the first `length` elements
    array = shuffledValues.slice(0, length);
		getAnimations();
		total_width = 68/length;
		width = 0.8*total_width;
		margin = 0*total_width;

		for (let i = 0; i < length; i++) {
			createDiv(array[i]);
		}

	}

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

	function createDiv(value){
		let container = document.createElement("container");
		let element = document.createElement("div");
		let label = document.createElement("div");
		element.classList.add("array-element");
		element.style.width = width + "em";
		element.style.margin = margin + "em";
		element.style.height = (value / 19) + "em";
		label.classList.add("element-label");
		container.appendChild(label);
		container.appendChild(element);
		document.getElementById("visual-array").appendChild(container);
	}
</script>